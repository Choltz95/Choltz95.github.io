<!doctype html>
<html>
  <head>
    <title>Color-Naming-Stroop</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://choltz95.github.io/projects/jspsych-5.0.3/jspsych.js"></script>
    <script src="https://choltz95.github.io/projects/jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="https://choltz95.github.io/projects/jspsych-5.0.3/plugins/jspsych-textTimed.js"></script>
    <script src="https://choltz95.github.io/projects/jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
    <link href="https://choltz95.github.io/projects/jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <style>
      body { font-size: 125%; } /* global font size */
      #go {
        width: 30%;
        height: 80px;
        margin: 0 auto;
        -webkit-border-radius: 25px;
        -moz-border-radius: 25px;
        border-radius: 25px;
        background: red;
      }
    </style>
  </head>
  <body>
    <div id="jspsych_target"></div>
    <div>test</div>
  </body>
  <script>
  /* define instructions block */

  var instructions_block = {
    type: "text",
    text: "<p>You will shortly see a series of words on the screen. During each trial, a word will appear printed in either red or blue. If the word is in <font color='red'>red</font>, press the '<font color='red'>J</font>' on the keyboard. If the word is in <font color='blue'>blue</font>, press the '<font color='blue'>F</font>' key. A &quot;+&quot; will appear on the screen before each word appears to show you where to look. Your task is to indicate the color of each word as quickly and as accurately as you can. Try not to make mistakes, but try to be fast. Your responses will be timed. The task will take less than 10 minutes.</p>" +
    
      "<p>Press ANY KEY to start...</p>",
    timing_post_trial: 4000
  };
  
  var fixation_block = {
    type: "single-stim",
    stimulus:"<h1>&#10010;<h1>",
    is_html: true,
    timing_response: 500,
    timing_post_trial: 0,
    response_ends_trial: false,
    data:{
      block: 'fixation'
    }
  };

  /* define test blocks */
  var colors = ["blue", "red"];
  var practice_wordlist = ["ZZZZZ","BBBBB","VVVVV","WWWWW","FFFFF","NNNNN","QQQQQ","UUUUU","HHHHH","SSSSS","JJJJJ","PPPPP"];
  var suicide_wordlist = ["suicide","die","funeral","overdose","drowning","poisoning","dead","lifeless","disappear","jumping","fatal","hanging","cutting","escape","deadly","dying","crisis","lethal","death","suicidal"];
  var negative_wordlist = ["alone","rejected","pathetic","worthless","lonely","worried","numb","gloomy","frightened","miserable","crying","failure","hurting","disappointing","pain","stupid","ugly","fear","disgust","anger"];
  var neutral_wordlist = ["dresser","shelf","cupboard","closet","laundry","drawer","oven","stool","sofa","couch","cabinet","dishwasher","chair","bench","bed","towel","shower","window","carpet","curtains"];
  //var test_wordlist =  suicide_wordlist.concat(negative_wordlist, positive_wordlist, neutral_wordlist)
  var test_wordlist = {'suicide':suicide_wordlist, 'negative':negative_wordlist,'neutral':neutral_wordlist};
  var practice_stimuli = [];
  var test_stimuli = []; // blocks
  var trial_index = 0;
  var block_index = 0;
  
  var practice_colors = jsPsych.randomization.repeat(colors, 6);
  for(var i=0;i<practice_wordlist.length;i++) {
    var color = practice_colors[i];
    var stim = {
      is_html: true,
      stimulus: "<h1 style='color:" + color + ";'>" + practice_wordlist[i] + "</h1>",
      data:{word: practice_wordlist[i],
            color: color,
            block: 'practice',
            block_num: 0,
            word_type: 'practice'
          }
    }
    practice_stimuli.push(stim);
  }
  
  var practice_trials = jsPsych.randomization.repeat(practice_stimuli, 1);
  for(var i=0;i<practice_trials.length; i+=2) {
    practice_trials.splice(i,0,fixation_block); // insert fixation block between each trial
  }
  var k = 0;
  for (var w_type in test_wordlist) {
    var wordlist = test_wordlist[w_type];
    var shuffled_wordlist = jsPsych.randomization.repeat(wordlist, 1);
    test_stimuli[k] = [];
    for(var i=0;i<wordlist.length;i++) {
      var stimb = {
        is_html: true,
        stimulus: "<h1 style='color:blue;'>" + shuffled_wordlist[i] + "</h1>",
        data:{word: shuffled_wordlist[i],
              color: 'blue',
              block: 'test',
              block_num: 0,
              word_type: w_type
            }
      }
      var stimr = {
        is_html: true,
        stimulus: "<h1 style='color:red;'>" + shuffled_wordlist[i] + "</h1>",
        data:{word: shuffled_wordlist[i],
              color: 'red',
              block: 'test',
              block_num: 0,
              word_type: w_type
            }
      }
      test_stimuli[k].push(jQuery.extend(true, {}, stimb));
      test_stimuli[k].push(jQuery.extend(true, {}, stimr));
    }
    k+=1;
  }
  var test_trials1 = jsPsych.randomization.repeat(test_stimuli[0], 1);
  var test_trials2 = jsPsych.randomization.repeat(test_stimuli[1], 1);
  var test_trials3 = jsPsych.randomization.repeat(test_stimuli[2], 1);
  for (var i = 0; i < test_trials1.length; i++) {
    test_trials1[i]['data']['block_num'] = 1;
    test_trials2[i]['data']['block_num'] = 2;
    test_trials3[i]['data']['block_num'] = 3;
  }

  for(var i=0;i<test_trials1.length; i+=2) {
    test_trials1.splice(i,0,fixation_block); // insert fixation block between each trial
    test_trials2.splice(i,0,fixation_block);
    test_trials3.splice(i,0,fixation_block);
  }

  var practice_block = {
    type: "single-stim",
    choices: ['f','j'],
    timing_response: 2000,
    timing_post_trial: 1500,
    on_finish: function(data){
      trial_index++;
      d = jsPsych.data.getLastTrialData()
      if(data.key_press == 70) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'f', participant_response:'blue'});
        if(d['color'] == 'blue') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if (data.key_press == 74) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'j', participant_response:'red'});
        if(d['color'] == 'red') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if(data.key_press == -1) {
        jsPsych.data.addDataToLastTrial({correct_response: 'noresponse'});
      } else { jsPsych.data.addDataToLastTrial({key_pressed: String.fromCharCode(data.key_press).toLowerCase(), correct_response: 'incorrect'}); }
    },
    timeline: practice_trials
  };

  var practice_debrief_block = {
    type: "text",
    text: function() {
      return "<p>You have completed the PRACTICE phase. If you would like to repeat the PRACTICE phase, press 1. If you would like to continue onto the TEST phase, press the spacebar.</p>";
    }
  };

  /* create experiment timeline array */
  var practice_timeline = [];
  practice_timeline.push(instructions_block);
  practice_timeline.push(practice_block);
  practice_timeline.push(practice_debrief_block);
  
  var practice_node = {
    timeline: practice_timeline,
    loop_function: function(data){
      if(49 == data[data.length-1].key_press) {
        return true;
      } else {
        return false;
      }
    }
  };
  
  var test_block1 = {
    type: "single-stim",
    choices: ['f','j'],
    timing_response: 2000,
    timing_post_trial: 1500,
    on_finish: function(data){
      trial_index++;
      d = jsPsych.data.getLastTrialData()
      if(data.key_press == 70) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'f', participant_response:'blue'});
        if(d['color'] == 'blue') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if (data.key_press == 74) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'j', participant_response:'red'});
        if(d['color'] == 'red') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if(data.key_press == -1) {
        jsPsych.data.addDataToLastTrial({correct_response: 'noresponse'});
      } else { jsPsych.data.addDataToLastTrial({key_pressed: String.fromCharCode(data.key_press).toLowerCase(), correct_response: 'incorrect'}); }
    },
    timeline: test_trials1
  };
  
  var test_block2 = {
    type: "single-stim",
    choices: ['f','j'],
    timing_response: 2000,
    timing_post_trial: 1500,
    on_finish: function(data){
      trial_index++;
      d = jsPsych.data.getLastTrialData()
      if(data.key_press == 70) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'f', participant_response:'blue'});
        if(d['color'] == 'blue') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if (data.key_press == 74) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'j', participant_response:'red'});
        if(d['color'] == 'red') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if(data.key_press == -1) {
        jsPsych.data.addDataToLastTrial({correct_response: 'noresponse'});
      } else { jsPsych.data.addDataToLastTrial({key_pressed: String.fromCharCode(data.key_press).toLowerCase(), correct_response: 'incorrect'}); }
    },
    timeline: test_trials2
  };
  
  var test_block3 = {
    type: "single-stim",
    choices: ['f','j'],
    timing_response: 2000,
    timing_post_trial: 1500,
    on_finish: function(data){
      trial_index++;
      d = jsPsych.data.getLastTrialData()
      if(data.key_press == 70) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'f', participant_response:'blue'});
        if(d['color'] == 'blue') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if (data.key_press == 74) {
        jsPsych.data.addDataToLastTrial({key_pressed: 'j', participant_response:'red'});
        if(d['color'] == 'red') {
          jsPsych.data.addDataToLastTrial({correct_response: 'correct'});
        } else {
          jsPsych.data.addDataToLastTrial({correct_response: 'incorrect'});
        }
      } else if(data.key_press == -1) {
        jsPsych.data.addDataToLastTrial({correct_response: 'noresponse'});
      } else { jsPsych.data.addDataToLastTrial({key_pressed: String.fromCharCode(data.key_press).toLowerCase(), correct_response: 'incorrect'}); }
    },
    timeline: test_trials3
  };
  
  var test_break_block = {
    type: "textTimed",
    cont_key: null,
    timeLeft: 30,
    text: function() {
      return "<div id='break_block'><div id='time' style='text-align:center; font-size: 150%;'></div><div style='text-align:center;'>Nice job! You've completed " + (Math.ceil((trial_index-12)/60)-1).toString() + " sets of trials. You have " + (4 - Math.ceil((trial_index-12)/60)).toString() + " sets of trials to go.</div></div><script>display = document.querySelector('#time');startTimer(30, display);</"+"script>"
    }
  };
  
  var test_debrief_block = {
    type: "textTimed",
    timeLeft: 1,
    text: function() {
      return "<p>End of color naming task. Thank you for completing the task!</p>"
    }
  };
  
  var test_timeline = [];
  test_timeline.push(test_block1);
  test_timeline.push(test_block2);
  test_timeline.push(test_block3);
  test_timeline_rand = jsPsych.randomization.repeat(test_timeline, 1);
  test_timeline_rand.splice(1,0,test_break_block);
  test_timeline_rand.splice(3,0,test_break_block);
  test_timeline_rand.push(test_debrief_block);
  
  var test_node = {
    type: "single-stim",
    timeline: test_timeline_rand
  }

  /* start the experiment */
  //$(document).ready(function(){
  jsPsych.init({
    display_element: 'jspsych_target',
    timeline: [practice_node,test_node],
    //timeline: [practice_node],

    on_finish: function() {
      jsPsych.data.localSave('data.csv', 'csv');
      
      console.log('done');
    }
  });
  //})
  
  function addInst() {
    //$('body').append("<div style='text-align:center; font-size: 80%;'>KEYS FOR THIS MODIFIED STROOP TASK: <font color='0000FF'>J=BLUE</font>; <font color='FF0000'>F=RED</font></div>" );
  }
  
  function startTimer(duration, display) {
    var start = Date.now(),
        diff,
        minutes,
        seconds;
    function timer() {
        // get the number of seconds that have elapsed since
        // startTimer() was called
        diff = duration - (((Date.now() - start) / 1000) | 0);

        // does the same job as parseInt truncates the float
        minutes = (diff / 60) | 0;
        seconds = (diff % 60) | 0;

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        if (diff <= 0) {
            // add one second so that the count down starts at the full duration
            // example 05:00 not 04:59
            start = Date.now() + 1000;
        }
    };
    // we don't want to wait a full second before the timer starts
    timer();
    setInterval(timer, 1000);
}
</script>
</html>
